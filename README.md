# AyaTsuki —— 基于Risc-V的CPU

## 分支简介

该分支引入了CPU分支预测功能，在DHT（快速哈达玛变换）的测试中具有72%的分支预测准确率，性能相对较好。

本分支预测器是基于马尔可夫的分支预测规则，通过上一次预测的正确性来动态调节这一次的预测结果。

预测器的马尔可夫实现是基于FSM（有限状态机）的，具体状态机转移矩阵如下所示：

$$
\begin{matrix} &nj_s&nj_w&rand&j_w&j_s\\
nj_s&√&&×\\
nj_w&&√&&&×\\
rand&nj&&&&j\\
j_w&×&&&√\\
j_s&&&×&&√\\
\end{matrix}
$$

上面的矩阵表示了五个状态转换的关系，其中有符号意义如下：

|符号|意义|
|:-:|:-:|
|$nj_s$|强不跳转倾向|
|$nj_w$|弱不跳转倾向|
|$rand$|随机倾向|
|$j_w$|弱跳转倾向|
|$j_s$|强跳转倾向|
|√|预测正确|
|×|预测错误|
|$nj/j$|上次预测结果|
